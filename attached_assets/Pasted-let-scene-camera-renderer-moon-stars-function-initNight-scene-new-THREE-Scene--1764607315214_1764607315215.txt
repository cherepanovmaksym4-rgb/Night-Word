let scene, camera, renderer, moon, stars=[];
function initNight(){
    scene=new THREE.Scene();
    scene.fog=new THREE.FogExp2(0x1a0033,0.002);
    camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
    camera.position.z=50;
    renderer=new THREE.WebGLRenderer({canvas:document.getElementById('nightCanvas'),antialias:true});
    renderer.setSize(window.innerWidth,window.innerHeight);

    let moonGeo=new THREE.SphereGeometry(5,32,32);
    let moonMat=new THREE.MeshStandardMaterial({color:0xaa66ff,emissive:0x9933ff});
    moon=new THREE.Mesh(moonGeo,moonMat);
    moon.position.set(20,20,-50);
    scene.add(moon);

    for(let i=0;i<200;i++){
        let starGeo=new THREE.SphereGeometry(0.2,8,8);
        let starMat=new THREE.MeshBasicMaterial({color:0xffffff});
        let star=new THREE.Mesh(starGeo,starMat);
        star.position.set((Math.random()-0.5)*200,(Math.random()-0.5)*200,(Math.random()-0.5)*200);
        stars.push(star);
        scene.add(star);
    }

    scene.add(new THREE.AmbientLight(0xffffff,0.5));
    let pointLight=new THREE.PointLight(0xff66ff,1);
    pointLight.position.set(50,50,50);
    scene.add(pointLight);

    window.addEventListener('resize',onResize,false);
    animateNight();
}
function animateNight(){
    requestAnimationFrame(animateNight);
    moon.rotation.y+=0.001;
    stars.forEach(s=>s.rotation.y+=0.001);
    renderer.render(scene,camera);
}
function onResize(){
    camera.aspect=window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth,window.innerHeight);
}
initNight();

const aiBtn=document.getElementById('aiBtn');
const aiNotification=document.getElementById('aiNotification');
const closeNotification=document.getElementById('closeNotification');
aiBtn.addEventListener('click',()=>{
    aiNotification.classList.add('show');
    aiNotification.classList.remove('hidden');
});
closeNotification.addEventListener('click',()=>{
    aiNotification.classList.remove('show');
    setTimeout(()=>aiNotification.classList.add('hidden'),400);
});

let roadmapScene, roadmapCamera, roadmapRenderer, roadmapItems=[];
function initRoadmap(){
    roadmapScene=new THREE.Scene();
    roadmapScene.fog=new THREE.FogExp2(0x1a0033,0.005);
    roadmapCamera=new THREE.PerspectiveCamera(75,window.innerWidth/500,0.1,1000);
    roadmapCamera.position.z=50;

    roadmapRenderer=new THREE.WebGLRenderer({antialias:true});
    roadmapRenderer.setSize(window.innerWidth,500);
    document.getElementById('roadmapCanvas').appendChild(roadmapRenderer.domElement);

    let stages=[
        {text:"Q1 2026 - Запуск AI (улучшенная форма)",color:0xff66ff},
        {text:"Q2 2026 - Интеррактивные истории и роли",color:0x9966ff},
        {text:"Q3 2026 - Сообщества и ночные события",color:0x6600cc},
        {text:"Q4 2026 - Полная соц-платформа Night Word",color:0xaa33ff}
    ];

    stages.forEach((stage,i)=>{
        let geometry;
        if(i==0) geometry=new THREE.BoxGeometry(10,5,2);
        else if(i==1) geometry=new THREE.SphereGeometry(5,32,32);
        else if(i==2) geometry=new THREE.OctahedronGeometry(5);
        else geometry=new THREE.ConeGeometry(5,10,32);

        let material=new THREE.MeshStandardMaterial({color:stage.color,emissive:stage.color,emissiveIntensity:0.6,transparent:true,opacity:0.9});
        let mesh=new THREE.Mesh(geometry,material);

        let angle=(i/(stages.length-1))*Math.PI*0.7-Math.PI/2;
        mesh.position.set(Math.cos(angle)*20,Math.sin(angle)*8,-i*5);
        mesh.rotation.x=Math.random()*0.5;
        mesh.rotation.y=Math.random()*0.5;

        roadmapScene.add(mesh);
        roadmapItems.push(mesh);

        let canvas=document.createElement('canvas');
        canvas.width=512; canvas.height=256;
        let ctx=canvas.getContext('2d');
        ctx.fillStyle="#ffffff";
        ctx.font="28px Arial";
        ctx.fillText(stage.text,10,130);
        let texture=new THREE.CanvasTexture(canvas);
        let spriteMat=new THREE.SpriteMaterial({map:texture});
        let sprite=new THREE.Sprite(spriteMat);
        sprite.scale.set(20,10,1);
        sprite.position.set(Math.cos(angle)*20,Math.sin(angle)*8+8,-i*5);
        roadmapScene.add(sprite);
    });

    let light=new THREE.PointLight(0xff66ff,1);
    light.position.set(50,50,50);
    roadmapScene.add(light);

    animateRoadmap();
}
function animateRoadmap(){
    requestAnimationFrame(animateRoadmap);
    roadmapItems.forEach(box=>box.rotation.y+=0.01);
    roadmapRenderer.render(roadmapScene,roadmapCamera);
}
initRoadmap();